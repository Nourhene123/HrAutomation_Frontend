<div class="container">
  <!-- Header avec le bouton de retour, le titre, et le bouton pour générer le rapport -->
  <div class="header">
    <button class="btn-return" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Back
    </button>
    <h2>
      <i class="fas fa-poll"></i> Survey Responses{{ survey ? ': ' + survey.Title : '' }}
    </h2>
    <button class="btn-report" (click)="generateReport()">
      <i class="fas fa-file-pdf"></i> Generate Report
    </button>
  </div>

  <!-- Indicateur de chargement -->
  <div *ngIf="isLoading" class="alert alert-info">
    <i class="fas fa-spinner fa-spin"></i> Loading...
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="alert alert-danger">
    <i class="fas fa-exclamation-circle"></i> {{ errorMessage }}
  </div>

  <!-- Contenu principal (statistiques et réponses) -->
  <div *ngIf="!isLoading && !errorMessage">
    <!-- Section des statistiques avec graphiques intégrés -->
    <div class="stats-card">
      <h3><i class="fas fa-chart-line"></i> Survey Statistics</h3>
      <div class="stats-overview">
        <p><strong>Total Responses:</strong> {{ stats.totalResponses }}</p>
        <p><strong>Participation Rate:</strong> {{ stats.participationRate | number:'1.0-2' }}%</p>
      </div>

      <!-- Moyennes des questions de type "rating" et graphique -->
      <div *ngIf="stats.averages.length > 0" class="stats-section">
        <h4>Average Ratings</h4>
        <div class="stats-content">
          <div class="stats-text">
            <p *ngFor="let avg of stats.averages">
              <strong>{{ avg.questionText }}:</strong> {{ avg.average | number:'1.0-2' }} / 5
            </p>
          </div>
          <div class="chart-wrapper">
            <canvas id="averageChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Répartition des réponses pour les questions de type "radio" et graphiques -->
      <div *ngIf="stats.distributions.length > 0" class="stats-section">
        <h4>Answer Distributions</h4>
        <div *ngFor="let dist of stats.distributions; let i = index" class="distribution-item">
          <div class="stats-content">
            <div class="stats-text">
              <p><strong>{{ dist.questionText }}:</strong></p>
              <ul>
                <li *ngFor="let option of dist.options | keyvalue">
                  {{ option.key }}: {{ option.value }} response{{ option.value !== 1 ? 's' : '' }}
                </li>
              </ul>
            </div>
            <div class="chart-wrapper">
              <canvas [id]="'distChart' + i"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Liste des réponses individuelles -->
    <div class="response-list">
      <h3><i class="fas fa-list"></i> Individual Responses</h3>
      <div *ngIf="groupedResponses.length === 0" class="alert alert-info">
        <i class="fas fa-info-circle"></i> No responses available for this survey.
      </div>
      <div *ngFor="let group of groupedResponses" class="employee-response-card">
        <div class="employee-header">
          <h3><i class="fas fa-user"></i> {{ group.employeeName }}</h3>
          <p class="response-date"><strong><i class="fas fa-calendar-alt"></i> Response Date:</strong> {{ group.respondedAt | date:'medium' }}</p>
        </div>
        <div *ngFor="let answer of group.answers" class="answer-item">
          <p><strong><i class="fas fa-question-circle"></i> Question:</strong> {{ answer.questionText }}</p>
          <p><strong><i class="fas fa-comment"></i> Answer:</strong> {{ answer.answer }}</p>
        </div>
      </div>
    </div>
  </div>
</div>